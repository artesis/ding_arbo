<?php

define('FLV_ADDR', 'http://localhost/index.php?file=');
define('RESPONDER_ADDR', 'http://localhost/index.php');
define('ARBO_PATH', drupal_get_path('module', 'ding_arbo'));

/**
 * @file
 *
 * Implements hook_menu().
 */
function ding_arbo_menu() {
  $items = array();

  $items['admin/config/arbo'] = array(
    'title' => 'ARBO config',
    'description' => 'Configuration page for ARBO module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('arbo_config_form'),
    'access arguments' => array('access adminitration pages'),
  );

  $items['arbo/call'] = array(
    'title' => 'ARBO YT responder',
    'description' => 'Retrieves the uploaded video review ID generated by YT',
    'page callback' => 'arbo_responder',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'ding_arbo.ajax.inc',
  );

  return $items;
}

/**
 * Implements hook_ctools_plugin_directory().
 */
function ding_arbo_ctools_plugin_directory($module, $plugin) {
  if ($module == 'ctools') {
    return 'plugins/' . $plugin;
  }
}

/**
 * Implements hook_theme().
 */
function ding_arbo_theme() {

  $review_data = array();

  $hooks['arbo_widget'] = array(
    'variables' => array('data' => $review_data, 'config' => NULL),
    'template' => 'arbo-widget'
  );

  return $hooks;
}

/**
 * Implements hook_help().
 */
function ding_arbo_help($path, $arg) {
  if ($path == 'admin/help#arbo') {
    return t('ARBO module provides an interface that allow users to watch and post video reviews.');
  }
}

/**
 * Create and display ARBO configuration form.
 */
function ding_arbo_config_form($form_state) {
  $form['arbo_flv_server_addr'] = array(
    '#type' => 'textfield',
    '#default_value' => variable_get('arbo_flv_server_addr', FLV_ADDR),
    '#title' => t('FLV address'),
    '#description' => t('Server address where FLV\'s can be accessed., e.g. http://localhost/index.php?file='),
    '#size' => 40,
    '#maxlength' => '256',
    '#required' => TRUE,
  );

  $form['ding_arbo_responder_server_addr'] = array(
    '#type' => 'textfield',
    '#default_value' => variable_get('arbo_responder_server_addr', RESPONDER_ADDR),
    '#title' => t('Upload responder'),
    '#description' => t('Server address which replies a newly uploaded video YouTube unique ID, e.g. http://localhost/index.php'),
    '#size' => 40,
    '#maxlength' => '256',
    '#required' => TRUE,
  );

  return system_settings_form($form);
}
